<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Calcul de moyenne</title>
<style>
    body { font-family: Arial, sans-serif; }
    .matiere { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; width: 400px; position: relative; transition: background 0.5s; }
    .bouton-ajouter, .bouton-supprimer { margin-top: 5px; margin-right: 5px; }
    .coef { font-weight: bold; display: none; }
    .notes-hidden input { display: none; }
    .global-controls { margin-bottom: 20px; }
    .global-controls button, .global-controls label { margin-right: 10px; }
</style>
</head>
<body>

<h1>Calcul de moyenne</h1>

<div class="global-controls">
    <label><input type="checkbox" id="toggle-coefs"> Afficher coefficients</label>
    <label><input type="checkbox" id="toggle-notes"> Masquer toutes les notes</label>
    <button id="supprimer-tout">Tout supprimer</button>
    <label><input type="checkbox" id="toggle-bg"> Fond dÃ©gradÃ© selon moyenne</label>
</div>

<div id="matieres-container"></div>

<button onclick="calculerMoyenne()">Calculer la moyenne gÃ©nÃ©rale</button>
<h2 id="resultat"></h2>

<script>
const matieres = [
    {nom:"Maths", coef:7, id:"maths", ds:true, tests:true},
    {nom:"Physique", coef:7, id:"physique"},
    {nom:"Chimie", coef:4, id:"chimie"},
    {nom:"Biologie", coef:3, id:"biologie"},
    {nom:"Info", coef:3, id:"info"},
    {nom:"Culture G", coef:1.5, id:"cultureg"},
    {nom:"LV2", coef:1.5, id:"LV2"},
    {nom:"Anglais", coef:1.5, id:"anglais"},
    {nom:"Sport", coef:1.5, id:"sport"}
];

const container = document.getElementById("matieres-container");

// GÃ©nÃ©ration dynamique
matieres.forEach(m=>{
    const div = document.createElement("div");
    div.className="matiere";
    div.id=m.id;
    div.dataset.coef=m.coef;

    let html=`<h3>${m.nom} <span class="coef">(coef ${m.coef})</span></h3>`;
    if(m.ds){
        html+=`<strong>DS</strong><div id="${m.id}-controles"><input type="number" min="0" max="20"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-controles')" style="display:none;">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-controles')" style="display:none;">ðŸ—‘</button>
               <br><br>
               <strong>Tests</strong><div id="${m.id}-tests"><input type="number" min="0" max="5"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-tests')" style="display:none;">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-tests')" style="display:none;">ðŸ—‘</button>`;
    } else {
        html+=`<div id="${m.id}-notes"><input type="number" min="0" max="20"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-notes')" style="display:none;">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-notes')" style="display:none;">ðŸ—‘</button>`;
    }
    div.innerHTML=html;
    container.appendChild(div);
});

// --- Ajouter / supprimer note ---
function ajouterNote(id){
    const div=document.getElementById(id);
    const inputs=div.querySelectorAll("input");
    if(inputs[inputs.length-1].value==="") return;
    const input=document.createElement("input");
    input.type="number";
    input.min=0;
    input.max=id.includes("tests")?5:20;
    div.appendChild(document.createElement("br"));
    div.appendChild(input);
    majBoutons(div);
}

function supprimerDerniere(id){
    const div=document.getElementById(id);
    const inputs=div.querySelectorAll("input");
    if(inputs.length<=1){inputs[0].value="";}
    else{div.removeChild(inputs[inputs.length-1].previousSibling); div.removeChild(inputs[inputs.length-1]);}
    majBoutons(div);
}

// --- Mise Ã  jour boutons + et ðŸ—‘ ---
function majBoutons(div){
    const inputs=div.querySelectorAll("input");
    const last=inputs[inputs.length-1];
    const btns=div.querySelectorAll(".bouton-ajouter, .bouton-supprimer");
    btns.forEach(b=>b.style.display=last.value!==""?"inline-block":"none");
}

// --- Calculs de moyennes ---
function moyenneMatiere(id){
    const inputs=document.querySelectorAll(`#${id} input`);
    let somme=0,count=0;
    inputs.forEach(i=>{ const v=Number(i.value); if(!isNaN(v)){somme+=v; count++;}});
    return count>0?somme/count:0;
}
function moyenneMaths(){
    const mCont=moyenneMatiere("maths-controles");
    const mTests=moyenneMatiere("maths-tests");
    return (mCont + mTests/6)/(1+1/6);
}

// --- Calcul moyenne gÃ©nÃ©rale ---
function calculerMoyenne(){
    let mg=7*moyenneMaths()+
           7*moyenneMatiere("physique-notes")+
           4*moyenneMatiere("chimie-notes")+
           3*moyenneMatiere("biologie-notes")+
           3*moyenneMatiere("info-notes")+
           1.5*moyenneMatiere("cultureg-notes")+
           1.5*moyenneMatiere("LV2-notes")+
           1.5*moyenneMatiere("anglais-notes")+
           1.5*moyenneMatiere("sport-notes");
    mg/=30;
    document.getElementById("resultat").textContent="Moyenne gÃ©nÃ©rale : "+mg.toFixed(2);
    if(document.getElementById("toggle-bg").checked) colorerFond();
}

// --- Boutons globaux ---
document.getElementById("toggle-coefs").addEventListener("change",function(){
    document.querySelectorAll(".coef").forEach(c=>c.style.display=this.checked?"inline":"none");
});

document.getElementById("toggle-notes").addEventListener("change",function(){
    document.querySelectorAll(".matiere div[id]").forEach(d=>d.classList.toggle("notes-hidden",this.checked));
    document.getElementById("resultat").style.display=this.checked?"none":"block";
    if(this.checked) document.querySelectorAll(".matiere").forEach(d=>d.style.background="white");
});

document.getElementById("supprimer-tout").addEventListener("click",function(){
    if(!confirm("Voulez-vous vraiment supprimer toutes les notes ?")) return;
    document.querySelectorAll(".matiere div[id] input").forEach(i=>i.value="");
    document.querySelectorAll(".matiere div[id] br").forEach(br=>br.remove());
    document.querySelectorAll(".bouton-ajouter, .bouton-supprimer").forEach(b=>b.style.display="none");
    document.getElementById("resultat").textContent="";
    document.querySelectorAll(".matiere").forEach(d=>d.style.background="white");
});

document.getElementById("toggle-bg").addEventListener("change",function(){
    if(this.checked) colorerFond(); 
    else document.querySelectorAll(".matiere").forEach(d=>d.style.background="white");
});

// --- Fond dÃ©gradÃ© smooth ---
function colorerFond(){
    matieres.forEach(m=>{
        let moyenne = m.ds ? moyenneMaths() : moyenneMatiere(`${m.id}-notes`);
        document.getElementById(m.id).style.background=noteToColorSmooth(moyenne);
    });
}

function noteToColorSmooth(note){
    // RGB interpolation: 0=red, 10=green, 20=blue
    note=Math.max(0,Math.min(20,note));
    let r,g,b;
    if(note<=10){
        // 0->10 : rouge->vert
        let t=note/10;
        r=Math.round(255*(1-t));
        g=Math.round(255*t);
        b=0;
    } else {
        // 10->20 : vert->bleu
        let t=(note-10)/10;
        r=0;
        g=Math.round(255*(1-t));
        b=Math.round(255*t);
    }
    return `rgb(${r},${g},${b})`;
}

// --- Initialisation boutons pour chaque matiÃ¨re ---
document.querySelectorAll(".matiere div[id]").forEach(div=>{
    div.querySelectorAll("input").forEach(input=>{
        input.addEventListener("input",()=>majBoutons(div));
    });
    majBoutons(div);
});
</script>
</body>
</html>

