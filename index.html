<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Calcul de moyenne</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .matiere {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            width: 400px;
            position: relative;
        }
        .bouton-ajouter, .bouton-supprimer {
            margin-top: 5px;
            margin-right: 5px;
        }
        .coef {
            font-weight: bold;
            display: none;
        }
        .notes-hidden input {
            display: none;
        }
        .global-controls {
            margin-bottom: 20px;
        }
        .global-controls button, .global-controls label {
            margin-right: 10px;
        }
    </style>
</head>
<body>

<h1>Calcul de moyenne</h1>

<div class="global-controls">
    <label><input type="checkbox" id="toggle-coefs"> Afficher coefficients</label>
    <label><input type="checkbox" id="toggle-notes"> Masquer toutes les notes</label>
    <button id="supprimer-tout">Tout supprimer</button>
</div>

<!-- EXEMPLE : Maths -->
<div class="matiere" data-coef="7" id="maths">
    <h3>Maths <span class="coef">(coef 7)</span></h3>

    <strong>DS</strong>
    <div id="maths-controles">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('maths-controles')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('maths-controles')" style="display:none;">ðŸ—‘</button>

    <br><br>

    <strong>Tests</strong>
    <div id="maths-tests">
        <input type="number" min="0" max="5">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('maths-tests')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('maths-tests')" style="display:none;">ðŸ—‘</button>
</div>

<!-- PHYSIQUE -->
<div class="matiere" data-coef="7" id="physique">
    <h3>Physique <span class="coef">(coef 7)</span></h3>
    <div id="physique-notes">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('physique-notes')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('physique-notes')" style="display:none;">ðŸ—‘</button>
</div>

<!-- CHIMIE -->
<div class="matiere" data-coef="4" id="chimie">
    <h3>Chimie <span class="coef">(coef 4)</span></h3>
    <div id="chimie-notes">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('chimie-notes')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('chimie-notes')" style="display:none;">ðŸ—‘</button>
</div>

<!-- BIOLOGIE -->
<div class="matiere" data-coef="3" id="biologie">
    <h3>Biologie <span class="coef">(coef 3)</span></h3>
    <div id="biologie-notes">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('biologie-notes')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('biologie-notes')" style="display:none;">ðŸ—‘</button>
</div>

<!-- INFO -->
<div class="matiere" data-coef="3" id="info">
    <h3>Info <span class="coef">(coef 3)</span></h3>
    <div id="info-notes">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('info-notes')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('info-notes')" style="display:none;">ðŸ—‘</button>
</div>

<!-- CULTURE G -->
<div class="matiere" data-coef="1.5" id="cultureg">
    <h3>Culture G <span class="coef">(coef 1.5)</span></h3>
    <div id="cultureg-notes">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('cultureg-notes')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('cultureg-notes')" style="display:none;">ðŸ—‘</button>
</div>

<!-- LV2 -->
<div class="matiere" data-coef="1.5" id="LV2">
    <h3>LV2 <span class="coef">(coef 1.5)</span></h3>
    <div id="LV2-notes">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('LV2-notes')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('LV2-notes')" style="display:none;">ðŸ—‘</button>
</div>

<!-- ANGLAIS -->
<div class="matiere" data-coef="1.5" id="anglais">
    <h3>Anglais <span class="coef">(coef 1.5)</span></h3>
    <div id="anglais-notes">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('anglais-notes')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('anglais-notes')" style="display:none;">ðŸ—‘</button>
</div>

<!-- SPORT -->
<div class="matiere" data-coef="1.5" id="sport">
    <h3>Sport <span class="coef">(coef 1.5)</span></h3>
    <div id="sport-notes">
        <input type="number" min="0" max="20">
    </div>
    <button class="bouton-ajouter" onclick="ajouterNote('sport-notes')" style="display:none;">+</button>
    <button class="bouton-supprimer" onclick="supprimerDerniere('sport-notes')" style="display:none;">ðŸ—‘</button>
</div>

<button onclick="calculerMoyenne()">Calculer la moyenne gÃ©nÃ©rale</button>
<h2 id="resultat"></h2>

<script>
    // --- Ajouter une note ---
    function ajouterNote(matiereId) {
        let div = document.getElementById(matiereId);
        let inputs = div.querySelectorAll("input");
        let dernierInput = inputs[inputs.length - 1];

        if (dernierInput.value === "") return;

        let input = document.createElement("input");
        input.type = "number";
        input.min = div.id.includes("tests") ? 0 : 0;
        input.max = div.id.includes("tests") ? 5 : 20;

        div.appendChild(document.createElement("br"));
        div.appendChild(input);

        majBoutons(div);
    }

    // --- Supprimer derniÃ¨re note ---
    function supprimerDerniere(matiereId) {
        let div = document.getElementById(matiereId);
        let inputs = div.querySelectorAll("input");
        if (inputs.length <= 1) {
            inputs[0].value = "";
        } else {
            div.removeChild(inputs[inputs.length - 1].previousSibling); // <br>
            div.removeChild(inputs[inputs.length - 1]);
        }
        majBoutons(div);
    }

    // --- Moyennes ---
    function moyenneMatiere(matiereId) {
        let inputs = document.querySelectorAll(`#${matiereId} input`);
        let somme = 0, count = 0;
        inputs.forEach(input => {
            let val = Number(input.value);
            if (!isNaN(val)) { somme += val; count++; }
        });
        return count > 0 ? somme / count : 0;
    }

    function moyenneMaths() {
        let moyenneControles = moyenneMatiere("maths-controles");
        let moyenneTests = moyenneMatiere("maths-tests");
        return (moyenneControles + (moyenneTests / 6)) / (1 + 1/6);
    }

    function calculerMoyenne() {
        let moyenneGenerale = (
            7 * moyenneMaths() +
            7 * moyenneMatiere("physique-notes") +
            4 * moyenneMatiere("chimie-notes") +
            3 * moyenneMatiere("biologie-notes") +
            3 * moyenneMatiere("info-notes") +
            1.5 * moyenneMatiere("cultureg-notes") +
            1.5 * moyenneMatiere("LV2-notes") +
            1.5 * moyenneMatiere("anglais-notes") +
            1.5 * moyenneMatiere("sport-notes")
        ) / 30;

        document.getElementById("resultat").textContent =
            "Moyenne gÃ©nÃ©rale : " + moyenneGenerale.toFixed(2);
    }

    // --- Met Ã  jour les boutons + et corbeille ---
    function majBoutons(div) {
        let inputs = div.querySelectorAll("input");
        let dernierInput = inputs[inputs.length - 1];
        let boutonAjouter = div.nextElementSibling;
        let boutonSupprimer = boutonAjouter ? boutonAjouter.nextElementSibling : null;

        if (dernierInput.value !== "") {
            if (boutonAjouter) boutonAjouter.style.display = "inline-block";
            if (boutonSupprimer) boutonSupprimer.style.display = "inline-block";
        } else {
            if (boutonAjouter) boutonAjouter.style.display = "none";
            if (boutonSupprimer) boutonSupprimer.style.display = "none";
        }
    }

    // --- Initialisation : ajouter events input pour chaque matiÃ¨re ---
    document.querySelectorAll(".matiere div[id]").forEach(div => {
        div.querySelectorAll("input").forEach(input => {
            input.addEventListener("input", () => majBoutons(div));
        });
        majBoutons(div);
    });

    // --- Boutons globaux ---
    document.getElementById("toggle-coefs").addEventListener("change", function() {
        document.querySelectorAll(".coef").forEach(span => {
            span.style.display = this.checked ? "inline" : "none";
        });
    });

    document.getElementById("toggle-notes").addEventListener("change", function() {
        document.querySelectorAll(".matiere div[id]").forEach(div => {
            div.classList.toggle("notes-hidden", this.checked);
        });
    });

    document.getElementById("supprimer-tout").addEventListener("click", function() {
        if (!confirm("Voulez-vous vraiment supprimer toutes les notes ?")) return;
        document.querySelectorAll(".matiere div[id] input").forEach(input => input.value = "");
        document.querySelectorAll(".matiere div[id] br").forEach(br => br.remove());
        document.querySelectorAll(".bouton-ajouter, .bouton-supprimer").forEach(b => b.style.display = "none");
    });
</script>

</body>
</html>
