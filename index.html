<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Calcul de moyenne</title>
<style>
body { font-family: Arial, sans-serif; background:white; }
.global-controls { margin-bottom: 20px; display: flex; align-items: center; flex-wrap: wrap; gap:10px; }
.global-controls button, .global-controls label { margin-right: 10px; }
#matieres-container { display: flex; flex-direction: column; gap: 20px; }
.matiere { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; width: 400px; box-sizing:border-box; }
.matiere input { margin-top: 5px; }
.bouton-ajouter, .bouton-supprimer { margin-top: 5px; margin-right: 5px; display:inline-block; }
.coef { font-weight: bold; display: none; }
.nb-notes { font-weight: normal; color: #555; display: none; margin-left: 5px; }
.notes-hidden input { display: none !important; }
.notes-hidden .label-ds, .notes-hidden .label-tests { display: none !important; }
.compteur { font-size: 0.9em; color: #555; margin-left: 10px; }
</style>
</head>
<body>

<h1>Calcul de moyenne</h1>

<div class="global-controls">
    <label><input type="checkbox" id="toggle-coefs"> Afficher coefficients</label>
    <label><input type="checkbox" id="toggle-nb-notes"> Afficher nombre de notes</label>
    <label><input type="checkbox" id="toggle-notes"> Masquer toutes les notes</label>
    <button id="supprimer-tout">Tout supprimer</button>
    <label><input type="checkbox" id="toggle-bg"> Fond dÃ©gradÃ© selon moyenne gÃ©nÃ©rale</label>
    <label>Affichage :
        <input type="range" id="display-mode" min="0" max="1" step="1" value="0">
        <span id="display-text">Ligne</span>
    </label>
</div>

<div id="matieres-container"></div>

<button onclick="calculerMoyenne()">Calculer la moyenne gÃ©nÃ©rale</button>
<h2 id="resultat"></h2>

<script>
const matieres = [
    {nom:"Maths", coef:7, id:"maths", ds:true, tests:true},
    {nom:"Physique", coef:7, id:"physique"},
    {nom:"Chimie", coef:4, id:"chimie"},
    {nom:"Biologie", coef:3, id:"biologie"},
    {nom:"Info", coef:3, id:"info"},
    {nom:"Culture G", coef:1.5, id:"cultureg"},
    {nom:"LV2", coef:1.5, id:"LV2"},
    {nom:"Anglais", coef:1.5, id:"anglais"},
    {nom:"Sport", coef:1.5, id:"sport"}
];

const container = document.getElementById("matieres-container");

// GÃ©nÃ©ration dynamique
matieres.forEach(m=>{
    const div = document.createElement("div");
    div.className="matiere";
    div.id=m.id;
    div.dataset.coef=m.coef;

    let html=`<h3>${m.nom} <span class="coef">(coef ${m.coef})</span> <span class="nb-notes">[0]</span></h3>`;
    if(m.ds){
        html+=`<strong class="label-ds">DS</strong>
               <div id="${m.id}-controles"><input type="number" min="0" max="20"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-controles')">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-controles')">ðŸ—‘</button>
               <br><br>
               <strong class="label-tests">Tests</strong>
               <div id="${m.id}-tests"><input type="number" min="0" max="5"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-tests')">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-tests')">ðŸ—‘</button>`;
    } else {
        html+=`<div id="${m.id}-notes"><input type="number" min="0" max="20"></div>
               <button class="bouton-ajouter" onclick="ajouterNote('${m.id}-notes')">+</button>
               <button class="bouton-supprimer" onclick="supprimerDerniere('${m.id}-notes')">ðŸ—‘</button>`;
    }
    div.innerHTML=html;
    container.appendChild(div);
});

// --- Ajouter / supprimer note ---
function ajouterNote(id){
    const div=document.getElementById(id);
    const inputs=div.querySelectorAll("input");
    const last=inputs[inputs.length-1];
    if(last.value==="") return;
    const input=document.createElement("input");
    input.type="number";
    input.min=0;
    input.max=id.includes("tests")?5:20;
    div.appendChild(document.createElement("br"));
    div.appendChild(input);
    majCompteur(div);
}

function supprimerDerniere(id){
    const div=document.getElementById(id);
    const inputs=div.querySelectorAll("input");
    if(inputs.length<=1){inputs[0].value="";} 
    else {div.removeChild(inputs[inputs.length-1].previousSibling); div.removeChild(inputs[inputs.length-1]);}
    majCompteur(div);
}

// --- Compteur de notes ---
function majCompteur(div){
    const compteur = div.parentNode.querySelector(".nb-notes");
    const inputs = div.querySelectorAll("input");
    let nb=0;
    inputs.forEach(i=>{if(i.value!=="") nb++;});
    compteur.textContent=`[${nb}]`;
}

// --- Calculs de moyennes ---
function moyenneMatiere(id){
    const inputs=document.querySelectorAll(`#${id} input`);
    let somme=0,count=0;
    inputs.forEach(i=>{ const v=Number(i.value); if(!isNaN(v)) {somme+=v; count++;} });
    return count>0?somme/count:0;
}
function moyenneMaths(){
    const mCont=moyenneMatiere("maths-controles");
    const mTests=moyenneMatiere("maths-tests");
    return (mCont + mTests/6)/(1+1/6);
}

// --- Calcul moyenne gÃ©nÃ©rale ---
function calculerMoyenne(){
    let mg=7*moyenneMaths()+
           7*moyenneMatiere("physique-notes")+
           4*moyenneMatiere("chimie-notes")+
           3*moyenneMatiere("biologie-notes")+
           3*moyenneMatiere("info-notes")+
           1.5*moyenneMatiere("cultureg-notes")+
           1.5*moyenneMatiere("LV2-notes")+
           1.5*moyenneMatiere("anglais-notes")+
           1.5*moyenneMatiere("sport-notes");
    mg/=30;
    const resElt=document.getElementById("resultat");
    resElt.textContent="Moyenne gÃ©nÃ©rale : "+mg.toFixed(2);
    resElt.style.display="block";
    if(document.getElementById("toggle-bg").checked) colorerFondGlobal(mg);
}

// --- Boutons globaux ---
document.getElementById("toggle-coefs").addEventListener("change",function(){
    document.querySelectorAll(".coef").forEach(c=>c.style.display=this.checked?"inline":"none");
});
document.getElementById("toggle-nb-notes").addEventListener("change",function(){
    document.querySelectorAll(".nb-notes").forEach(c=>c.style.display=this.checked?"inline":"none");
});
document.getElementById("toggle-notes").addEventListener("change",function(){
    const hide = this.checked;
    document.querySelectorAll(".matiere").forEach(d=>{
        d.classList.toggle("notes-hidden",hide);
        d.style.height="auto"; // uniformisation
    });
    document.querySelectorAll(".label-ds, .label-tests").forEach(e=>e.style.display=hide?"none":"inline");
    document.getElementById("resultat").style.display=hide?"none":"block";
    document.body.style.background="white";
});
document.getElementById("supprimer-tout").addEventListener("click",function(){
    document.querySelectorAll(".matiere div[id] input").forEach(i=>i.value="");
    document.querySelectorAll(".matiere div[id] br").forEach(br=>br.remove());
    document.querySelectorAll(".nb-notes").forEach(c=>c.textContent="[0]");
    document.getElementById("resultat").textContent="";
    document.body.style.background="white";
});

// --- Fond dÃ©gradÃ© global ---
function colorerFondGlobal(moyenne){
    moyenne=Math.max(0,Math.min(20,moyenne));
    let r,g,b;
    if(moyenne<=10){
        let t=moyenne/10;
        r=Math.round(255*(1-t));
        g=Math.round(255*t);
        b=0;
    } else {
        let t=(moyenne-10)/10;
        r=0;
        g=Math.round(255*(1-t));
        b=Math.round(255*t);
    }
    document.body.style.background=`rgb(${r},${g},${b})`;
}

// --- Affichage grille / ligne ---
document.getElementById("display-mode").addEventListener("input",function(){
    const val=this.value;
    const text=document.getElementById("display-text");
    if(val==0){
        container.style.flexDirection="column";
        container.style.flexWrap="nowrap";
        container.querySelectorAll(".matiere").forEach(m=>m.style.width="400px");
        text.textContent="Ligne";
    } else {
        container.style.flexDirection="row";
        container.style.flexWrap="wrap";
        container.querySelectorAll(".matiere").forEach(m=>m.style.width="30%");
        text.textContent="Grille";
    }
});

// --- Initialisation compteurs et boutons (toujours visibles aprÃ¨s 1Ã¨re note) ---
document.querySelectorAll(".matiere div[id]").forEach(div=>{
    div.querySelectorAll("input").forEach(i=>i.addEventListener("input",()=>{
        majCompteur(div);
        if(document.getElementById("toggle-bg").checked) calculerMoyenne();
    }));
    majCompteur(div);
    // Rendre les boutons + et corbeille visibles dÃ¨s la 1Ã¨re note
    const boutons = Array.from(div.parentNode.querySelectorAll(".bouton-ajouter, .bouton-supprimer"));
    boutons.forEach(b=>b.style.display="inline-block");
});
</script>

</body>
</html>
